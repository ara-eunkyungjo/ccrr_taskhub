<!DOCTYPE html>
<html>
   
    <head>
        
        <meta charset="utf-8">
        
        <title> __ </title>
        
       
        <script src="js/jspsych.js"></script>
<!--        <script src="js/jspsych-html-button-response.js"></script>-->
        <script src="js/jspsych-survey-multi-choiceOLD.js"></script>
        <script src="js/jspsych-survey-multi-choice-en-reading-check.js"></script>
        <script src="js/jspsych-html-button-response.js"></script>
        <script src="js/jspsych-html-keyboard-response.js"></script>
        <script src="js/shuffle.js"></script>

        
<!--        <script src="js/English.js"></script>-->
        <script src="js/Mandarin.js"></script>


        
        
<!--        formatting-->
        <link href="css/jspsych.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="css/w3.css">  
        
<!--        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>-->
<!--        china-friendly jquery cdn??-->
        <script src="https://ajax.lug.ustc.edu.cn/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
        <script src="https://ajax.lug.ustc.edu.cn/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<!--        end of formatting-->
        
        
    </head>
    
    <body></body>
    
    <script>
    
//        var CN = false;
        var timeline = []
    
 
    ///////////////////////////////////////////////////////
        
        // semantic intuition task from Machery paper


        //////// TASK VARIABLES

        
        
        // EN reading check for CN participants
        var en_reading_check = {
            type: 'survey-multi-choice-en-reading-check',
            button_label: question_button,
            questions: [
                {
                    prompt: en_reading_check_instr,
                    name: "en_reading_check",
                    options: en_reading_check_opt,
                    required: true,
                }
            ]
        }
        
        

        // feedback page: ineligible
        var en_reading_check_feedback_ineligible_page = {
            type: 'html-button-response',
            stimulus: en_reading_check_feedback_ineligible,
            choices: [questions_pre_button],
        }      
        
        
        
        // feedback page: eligible > main task
        var en_reading_check_feedback_eligible_page = {
            type: 'html-button-response',
            stimulus: en_reading_check_feedback_eligible,
            choices: [questions_pre_button],
        }  
        
        
        
        // task instruction
        var semantic_intuition_instr_page = {
            type: 'html-button-response',
            stimulus: semantic_intuition_instr,
            choices: [questions_pre_button],
        };
        
        
               
        // Godel 1
        var semantic_intuition_godel_1 = {
            type: 'survey-multi-choiceOLD',
            button_label: question_button,
            questions: [
                {
                    prompt: godel_1_story,
                    name: "godel_1",
                    options: godel_1_opt,
                    required: true,
                }
            ]
        }

        
        
        // Godel 2
        var semantic_intuition_godel_2 = {
            type: 'survey-multi-choiceOLD',
            button_label: question_button,
            questions: [
                {
                    prompt: godel_2_story,
                    name: "godel_2",
                    options: godel_2_opt,
                    required: true,
                }
            ]
        }

        
        
        // Jonah 1
        var semantic_intuition_jonah_1_para1 = {
            type: 'html-keyboard-response',
            stimulus: 'Please read carefully:',
            choices: jsPsych.ALL_KEYS,
            prompt: jonah_1_story_para1,
        } 
        var semantic_intuition_jonah_1_para2 = {
            type: 'html-keyboard-response',
            stimulus: 'Please read carefully:',
            choices: jsPsych.ALL_KEYS,
            prompt: jonah_1_story_para2,
        }
        var semantic_intuition_jonah_1_para3 = {
            type: 'html-keyboard-response',
            stimulus: 'Please read carefully:',
            choices: jsPsych.ALL_KEYS,
            prompt: jonah_1_story_para3,
        }         
        var semantic_intuition_jonah_1_all = {
            type: 'survey-multi-choiceOLD',
            button_label: question_button,
            questions: [
                {
                    prompt: jonah_1_story_all,
                    name: "jonah_1",
                    options: jonah_1_opt,
                    required: true,
                }
            ]
        }
        // Jonah 1 packaged       
        var semantic_intuition_jonah_1 = [
            semantic_intuition_jonah_1_para1,
            semantic_intuition_jonah_1_para2,
            semantic_intuition_jonah_1_para3,
            semantic_intuition_jonah_1_all
        ]   // packaged jonah 1 story and question
        

        
        
        // Jonah 2
        var semantic_intuition_jonah_2_para1 = {
            type: 'html-keyboard-response',
            stimulus: 'Please read carefully:',
            choices: jsPsych.ALL_KEYS,
            prompt: jonah_2_story_para1,
        }
        var semantic_intuition_jonah_2_para2 = {
            type: 'html-keyboard-response',
            stimulus: 'Please read carefully:',
            choices: jsPsych.ALL_KEYS,
            prompt: jonah_2_story_para2,
        }
        var semantic_intuition_jonah_2_para3 = {
            type: 'html-keyboard-response',
            stimulus: 'Please read carefully:',
            choices: jsPsych.ALL_KEYS,
            prompt: jonah_2_story_para3,
        }   
        var semantic_intuition_jonah_2_all = {
            type: 'survey-multi-choiceOLD',
            button_label: question_button,
            questions: [
                {
                    prompt: jonah_2_story_all,
                    name: "jonah_2",
                    options: jonah_2_opt,
                    required: true,
                }
            ]
        }
        // Jonah 2 packaged
        var semantic_intuition_jonah_2 = [
            semantic_intuition_jonah_2_para1,
            semantic_intuition_jonah_2_para2,
            semantic_intuition_jonah_2_para3,
            semantic_intuition_jonah_2_all
        ] // packaged jonah 2 story and question


        
        
        // all 4 subtasks shuffled and packaged
        var all_semantic_intuition_subtasks = 
            shuffle([
            semantic_intuition_godel_1,
            semantic_intuition_godel_2,
            semantic_intuition_jonah_1,
            semantic_intuition_jonah_2
        ]) // randomized subtasks
        
        
        
        
        // conditional function for CN "ineligible" timeline
        var if_node_ineligible = {
            timeline: [en_reading_check_feedback_ineligible_page],
            conditional_function: function(){
                var en_reading_check_response = jsPsych.data.get().filter({trial_type: 'survey-multi-choice-en-reading-check'}).values()[0].responses;
                console.log(en_reading_check_response);
                if(en_reading_check_response.includes("不能")){
                    return true;
                } else {
                    return false;
                }
            }
        }

        
        
        // conditional function for CN "eligible" timeline
        var if_node_eligible = {
            timeline: [en_reading_check_feedback_eligible_page].concat(semantic_intuition_instr_page,
                all_semantic_intuition_subtasks),
//            [
//                en_reading_check_feedback_eligible_page, 
//                semantic_intuition_instr_page,
//                all_semantic_intuition_subtasks
//            ],
            conditional_function: function(){
                var en_reading_check_response = jsPsych.data.get().filter({trial_type: 'survey-multi-choice-en-reading-check'}).values()[0].responses;
                console.log(en_reading_check_response);
                if(en_reading_check_response.includes("不能")){
                    return false;
                } else {
                    return true;
                }
            }
        }
        


        
//        timeline = timeline.concat([en_reading_check, if_node_ineligible, if_node_eligible])
        
        

        
        //////// PACKAGING
 
        
        var semantic_intuition_task =       [en_reading_check].concat(
            if_node_ineligible,
            if_node_eligible
        )  
 
        

//        var semantic_intuition_task =       [en_reading_check].concat(
//            semantic_intuition_instr_page,
//            all_semantic_intuition_subtasks
//        )   
        
//        console.log(semantic_intuition_task)
        

        
//////////////////////////////////////////////////////
    
                
        
    for (var i = 0; i < semantic_intuition_task.length; i++) {
        var current_task = semantic_intuition_task[i]
        timeline = timeline.concat(current_task)  // timeline.push does not take arrays
    }
        
        
    jsPsych.init({
        timeline: timeline,
        on_trial_finish: function(){jsPsych.data.displayData();}
    })
        
        
    
    
    </script>
    
</html>

